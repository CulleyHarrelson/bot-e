extends layout

block content
  head
    meta(name="description" content=description)
    link(rel="canonical" href=`https://bot-e.com/question/${question_id}`)
    meta(property="og:title" content=title)
    meta(property="og:description" content=description)
    meta(property="og:image" content=image_url)
    meta(property="og:url" content=`https://bot-e.com/question/${question_id}`)
    meta(name="twitter:card" content=description)
    meta(name="twitter:title" content=title)
    meta(name="twitter:description" content=description)
    meta(name="twitter:image" content=image_url)

  if !answer
    meta(http-equiv="refresh" content="10")
    style.
      /* Define keyframes for the animation */
      @keyframes progress-animation {
        0% {
          width: 0;
        }
        100% {
          width: 100%;
        }
      }

      /* Apply the animation to the progress bar */
      .progress-meter-animated {
        animation-name: progress-animation;
        animation-timing-function: linear;
        animation-fill-mode: forwards; /* Keep the final style after animation */
      }

      /* Style the container as needed */
      .progress-container {
        width: 100%;
        height: 20px; /* Adjust height as needed */
        background-color: #f0f0f0;
        border-radius: 5px;
        overflow: hidden; /* Hide overflowing content during animation */
      }

    script.
      document.addEventListener("DOMContentLoaded", function () {
        var progressMeter = document.querySelector(".progress-meter");
        progressMeter.style.animationDuration = "10s";
        // Start the animation by adding the animated class
        progressMeter.classList.add("progress-meter-animated");
      });
  else
    if !image_url
      meta(http-equiv="refresh" content="20")
    script(src='https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js')
    script.
      document.addEventListener('DOMContentLoaded', () => {
        const clipboard = new ClipboardJS('#copy-button', {
          text: () => window.location.href
        });

        clipboard.on('success', (e) => {
          e.clearSelection();

          const notice = document.createElement('div');
          notice.textContent = 'Link copied to clipboard';
          notice.classList.add('callout', 'success');
          document.body.appendChild(notice);

          setTimeout(() => {
            document.body.removeChild(notice);
          }, 3000); // Remove notice after 3 seconds
        });
      });
  +topBar
  .flex-container.align-center.margin-3
    .small-up-1.medium-up-2
      .card
        .card-section
          h4 !{title}
          if image_url
            img(src=image_url width=256 height=256 alt=title)
      .card
        .card-divider
          | Question
        .card-section
          p !{question}
        if media
          .card
            .card-divider
              | Media Recommendations
            .card-section
              each item in media
                p
                  a(href=`https://www.amazon.com/gp/search?ie=UTF8&tag=bote04-20&linkCode=ur2&linkId=cb41c8c087e0d9fb866de1f283c3a56c&camp=1789&creative=9325&index=books&keywords=${item.title} by ${item.author}`) #{item.title} by #{item.author}
                  |  (#{item.media_type}) - #{item.correlation} 
        if answer
          .card
            .card-divider
              | Answer
            .card-section
              h4 bot-e
              p !{answer}
        else
          .card
            .card-divider
              | Answer
            .card-section
              p.cell.small-12 It can take 10-15 seconds to respond - this page will refresh every 10 seconds until your response is ready.
              .cell.small-12
                .progress-container
                  .progress-meter(role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuetext="100 percent" aria-valuemax="100")
                    span.progress-meter-text
              .cell.small-12.text-center(style="padding-top: 20px;")
                button.button(type='button', onclick='location.reload();') I'm tired of waiting, refresh now!
  
