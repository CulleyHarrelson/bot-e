extends layout
block meta
    meta(property="og:title" content=title)
    meta(property="og:description" content=description)
    meta(property="og:image" content=image_url)
    meta(property="og:url" content=`https://bot-e.com/question/${question_id}`)
    meta(name="twitter:card" content=description)
    meta(name="twitter:title" content=title)
    meta(name="twitter:description" content=description)
    meta(name="twitter:image" content=image_url)
mixin navButtons
  .card
    .card-divider
      | View Another Question
      .card-section
    form(id="question-form" method="post" action="/next_question")
        input(type="hidden", name="question_id", value=questionId)
        input(type="hidden", name="session_id", value=sessionId)
        .grid-x.grid-margin-x.align-middle(style="padding-top: 10px;")
          .cell.medium-4.text-center
            button.button(type="button", name="direction" value="down", class="g-recaptcha", data-sitekey="6Le7yP8nAAAAAPUOVGZ9Xfu95Nco8h0vmUhUZ0u3", data-callback='onSubmitDown', data-tooltip, tabindex="3", title="Show me something else, not like this question.") Show me Something Different

          .cell.medium-4.text-center
            button.button(type="button", name="direction" value="random", class="g-recaptcha", data-sitekey="6Le7yP8nAAAAAPUOVGZ9Xfu95Nco8h0vmUhUZ0u3", data-callback='onSubmitRandom', data-tooltip, tabindex="2", title="Show a Random Question")
              | View Random Question

          .cell.medium-4.text-center
            button.button(type="button", name="direction" value="up", class="g-recaptcha", data-sitekey="6Le7yP8nAAAAAPUOVGZ9Xfu95Nco8h0vmUhUZ0u3", data-callback='onSubmitUp', data-tooltip, tabindex="1", title="Show me more questions like this one.") Show me Something Similar

  script.
    function submitForm(direction, token) {
      const questionId = document.querySelector('input[name="question_id"]').value;
      const sessionId = document.querySelector('input[name="session_id"]').value;
      const formData = new FormData();
      formData.append('direction', direction);
      formData.append('question_id', questionId);
      formData.append('session_id', sessionId);
      formData.append('recaptcha_token', token); 

      fetch('/navigate', { 
        method: 'POST',
        body: JSON.stringify(Object.fromEntries(formData)),
        headers: {
          'Content-Type': 'application/json', // Set the content type to JSON
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
            window.location.href = '/question/' + data['question_id'];
        } else {
          // reCAPTCHA verification failed, display an error or take appropriate action
          console.error('reCAPTCHA verification failed');
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }

    function onSubmitDown(token) {
      submitForm('down', token);
    }

    function onSubmitRandom(token) {
      submitForm('random', token);
    }

    function onSubmitUp(token) {
      submitForm('up', token);
    }


block content
  if error
    .error-shoutout
      p Error: #{error}

  style.
    .custom-icon {
      font-size: 24px;
    }
  if !answer
    meta(http-equiv="refresh" content="10")
    style.
      /* Define keyframes for the animation */
      @keyframes progress-animation {
        0% {
          width: 0;
        }
        100% {
          width: 100%;
        }
      }

      /* Apply the animation to the progress bar */
      .progress-meter-animated {
        animation-name: progress-animation;
        animation-timing-function: linear;
        animation-fill-mode: forwards; /* Keep the final style after animation */
      }

      /* Style the container as needed */
      .progress-container {
        width: 100%;
        height: 20px; /* Adjust height as needed */
        background-color: #f0f0f0;
        border-radius: 5px;
        overflow: hidden; /* Hide overflowing content during animation */
      }

    script.
      document.addEventListener("DOMContentLoaded", function () {
        var progressMeter = document.querySelector(".progress-meter");
        progressMeter.style.animationDuration = "10s";
        // Start the animation by adding the animated class
        progressMeter.classList.add("progress-meter-animated");
      });
  else
    if !image_url
      meta(http-equiv="refresh" content="20")
    script(src='https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js')
    script.
      document.addEventListener('DOMContentLoaded', () => {
        const clipboard = new ClipboardJS('#copy-button', {
          text: () => window.location.href
        });

        clipboard.on('success', (e) => {
          e.clearSelection();

          const notice = document.createElement('div');
          notice.textContent = 'Link copied to clipboard';
          notice.classList.add('callout', 'success');
          document.body.appendChild(notice);

          setTimeout(() => {
            document.body.removeChild(notice);
          }, 3000); // Remove notice after 3 seconds
        });
      });
  +topBar
  script.
      $(document).foundation();
  .flex-container.align-center.margin-3
    .small-up-1.medium-up-2
      if !answer
        .card
          .card-divider
            | Answer
          .card-section
            p.cell.small-12 It can take 10-15 seconds to respond - this page will refresh every 10 seconds until your response is ready.
            .cell.small-12
              .progress-container
                .progress-meter(role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuetext="100 percent" aria-valuemax="100")
                  span.progress-meter-text
            .cell.small-12.text-center(style="padding-top: 20px;")
              button.button(type='button', onclick='location.reload();') I'm tired of waiting, refresh now!
      .card
        .card-section
          h4 !{title}
          if image_url
            img(src=image_url width=256 height=256 alt=title)
      if !answer
      .card
        .card-divider
          | Question
        .card-section
          p !{question}
      if answer
        .card
          .card-divider
            | Answer
          .card-section
            h4 bot-e
            p !{answer}
        +navButtons
        .card
          .card-divider
            | Comments
          .card-section
            .row
              .small-12.columns
                form
                  .row
                    .small-12.medium-10.columns
                      input(type='text', id='comment', placeholder='Enter your comment', name='comment')
                    .small-12.medium-2.columns 
                      button(type='submit', class='button float-right g-recaptcha', data-sitekey="6Le7yP8nAAAAAPUOVGZ9Xfu95Nco8h0vmUhUZ0u3", data-callback='onCommentAdd', data-tooltip, tabindex="1", title="Show me more questions like this one.") Add Comment
                    script.
                      function onCommentAdd(token) {
                        const comment = document.querySelector('input[name="comment"]').value;
                        const questionId = document.querySelector('input[name="question_id"]').value;
                        const sessionId = document.querySelector('input[name="session_id"]').value;

                        const formData = new FormData();
                        formData.append('comment', comment);
                        formData.append('question_id', questionId);
                        formData.append('session_id', sessionId);
                        formData.append('recaptcha_token', token); 

                        fetch('/comment', { 
                          method: 'POST',
                          body: JSON.stringify(Object.fromEntries(formData)),
                          headers: {
                            'Content-Type': 'application/json', 
                          }
                        })
                        .then(response => response.json())
                        .then(data => {
                          if (data.success) {
                              window.location.href = '/question/' + data['question_id'];
                          } else {
                            console.error('reCAPTCHA verification failed');
                          }
                        })
                        .catch(error => {
                          console.error('Error:', error);
                        });
                      }

      if false
        each item in media
          if item.media_type == "song"
            .card
              .card-divider
                | !{item.media_type}: !{item.correlation}
              .card-section
                .responsive-embed
                  iframe(src=`https://www.youtube.com/embed/${item.videoId}` width="560" height="315" frameborder="0" allowfullscreen)
  
  +siteFooter
